# 一、状态管理

项目中状态管理使用 Pinia

回顾 Pinia 是什么？

- Pinia（发音为 /piːnjʌ/，如英语中的 peenya） 是 Vue 的存储库，它允许跨组件、页面共享状态。 


uni-app 内置了 Pinia，使用 HBuilder X 不需要手动安装，直接使用即可。 

使用 CLI 需要手动安装，执行如下命令安装：

```shell
yarn add pinia
# or
npm install pinia。
```

Pinia 使用步骤如下： 

1.在 `main.js` 中安装 Pinia 插件；

01-uni-app\demo-project\01-hello-uniapp\main.js

```js
import App from './App'
import * as Pinia from 'pinia'

// #ifdef VUE3
import { createSSRApp } from 'vue'
export function createApp() {
  const app = createSSRApp(App)
	
	app.use(Pinia.createPinia())
  return {
    app,
		Pinia
  }
}
// #endif
```

2.接着创建一个 store

01-uni-app\demo-project\01-hello-uniapp\store\counter.js

```js
import { defineStore } from 'pinia'

// counter 唯一的 name
export const useCounterStore = defineStore('counter', {
	state: () => ({
		count: 800
	}),
	actions: {
		increment() {
			this.count++
		},
		decrement() {
			this.count--
		}
	}
})
```

3.在组件中直接使用：

计数器案例实现。

01-uni-app\demo-project\01-hello-uniapp\pages\cart\cart.vue

```vue
<template>
	<view class="content">
		<button @click="onAddNumber">加1</button>
		<button @click="onSubNumber">减1</button>
		<view>{{ count }}</view>
	</view>
</template>

<script setup>
	import { storeToRefs } from 'pinia'
	import { useCounterStore } from '@/store/counter.js'
	
	const counterStore = useCounterStore()
	const { count } = storeToRefs(counterStore)
	
	const onAddNumber = () => {
		counterStore.increment()
	}
	const onSubNumber = () => {
		counterStore.decrement()
	}
</script>

<style lang="less">

</style>

```

跨组件状态共享实现。

01-uni-app\demo-project\01-hello-uniapp\pages\cart\cart.vue

```vue
<template>
	<view class="content">
		<navigator url="/pages/detail09/detail09">
			<button>GoToDetail09</button>
		</navigator>
	</view>
</template>
```

01-uni-app\demo-project\01-hello-uniapp\pages\detail09\detail09.vue

```vue
<template>
	<view>
		<button @click="onAddNumberClick">加1</button>
		<view>{{ count }}</view>
	</view>
</template>

<script setup>
	import { storeToRefs } from 'pinia'
	import { useCounterStore } from '@/store/counter.js'
	
	const counterStore = useCounterStore()
	const { count } = storeToRefs(counterStore)
	
	const onAddNumberClick = () => {
		counterStore.increment()
	}
	
</script>
```



